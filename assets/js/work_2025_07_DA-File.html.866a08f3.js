"use strict";(self.webpackChunkhb=self.webpackChunkhb||[]).push([[256],{8346:(e,a,l)=>{l.r(a),l.d(a,{comp:()=>n,data:()=>s});var i=l(641);const o={},n=(0,l(6262).A)(o,[["render",function(e,a){return(0,i.uX)(),(0,i.CE)("div",null,a[0]||(a[0]=[(0,i.Fv)('<h1 id="服务端部署说明" tabindex="-1"><a class="header-anchor" href="#服务端部署说明"><span>服务端部署说明</span></a></h1><h1 id="文件上传工具文档" tabindex="-1"><a class="header-anchor" href="#文件上传工具文档"><span>文件上传工具文档</span></a></h1><p>本文档描述了基于.NET 8开发的文件上传工具的实现方案和使用说明。</p><h2 id="开发文档" tabindex="-1"><a class="header-anchor" href="#开发文档"><span>开发文档</span></a></h2><h3 id="技术栈" tabindex="-1"><a class="header-anchor" href="#技术栈"><span>技术栈</span></a></h3><ul><li>后端：.NET 8 Web API , Redis, Hangfire定时器, Autofac , SqlSugar</li></ul><h3 id="_2-api接口设计" tabindex="-1"><a class="header-anchor" href="#_2-api接口设计"><span>2. API接口设计</span></a></h3><h4 id="_2-1-请求格式" tabindex="-1"><a class="header-anchor" href="#_2-1-请求格式"><span>2.1 请求格式</span></a></h4><blockquote><p>2.1.1   请求格式</p></blockquote><blockquote><p><strong>Request</strong> 统一使用实体类</p></blockquote><blockquote><p>Reponse 统一返回值</p></blockquote><blockquote><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/3M0OzeZ86vmXAqze/img/262d997d-a7cd-4cf4-ad3c-034baeccd7ed.png" alt="image.png"></p></blockquote><h4 id="_2-2-中间件" tabindex="-1"><a class="header-anchor" href="#_2-2-中间件"><span>2.2 中间件</span></a></h4><h5 id="_2-2-1-jwt" tabindex="-1"><a class="header-anchor" href="#_2-2-1-jwt"><span>2.2.1 JWT</span></a></h5><blockquote><p>需要注意的点为 ValidateLifetime = false 客户端需求不能token 过期</p></blockquote><blockquote><p>如需过期,可在ApiAuthorizeFilter上下文鉴权,根据jwt 颁发的token 判断来源是否为客户端,是则续签 -(会影响性能)</p></blockquote><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/3M0OzeZ86vmXAqze/img/7a820ce4-1007-424b-8e1d-07394b9fe585.png" alt="image.png"></p><h5 id="_2-2-2-日志" tabindex="-1"><a class="header-anchor" href="#_2-2-2-日志"><span>2.2.2 日志</span></a></h5><blockquote><p>ExceptionHandlerMiddleWare</p></blockquote><blockquote><p>记录request 和 reponse 请求日志</p></blockquote><blockquote><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/3M0OzeZ86vmXAqze/img/71962ead-d30d-41bf-ab79-6538aae1025a.png" alt="image.png"></p></blockquote><h3 id="_3-扩展功能" tabindex="-1"><a class="header-anchor" href="#_3-扩展功能"><span>3. 扩展功能</span></a></h3><h4 id="_3-1-hangfire-访问" tabindex="-1"><a class="header-anchor" href="#_3-1-hangfire-访问"><span>3.1 Hangfire 访问</span></a></h4><blockquote><p>url地址为 域名或者ip  路由 -&gt;  /hangfire</p></blockquote><blockquote><p>用户名 :DA            密码 : DAADMIN!</p></blockquote><h4 id="_3-2-hangfire-页面介绍" tabindex="-1"><a class="header-anchor" href="#_3-2-hangfire-页面介绍"><span>3.2 Hangfire 页面介绍</span></a></h4><ul><li>3.2.1 周期作业</li></ul><blockquote><p>AlertJob 为预警规则配置页面 , 自动加载 无需其他操作</p></blockquote><blockquote><p>FileUploadJob 文件关联iris 状态 任务</p></blockquote><blockquote><p>UserSyncJob 为定时同步机构和大小组关系到数据库</p></blockquote><blockquote><p>Cron 为执行周期, 可参考在线cron表达式</p></blockquote><blockquote><p>作业为 具体执行方法 例如 FileUploadJob.ExecuteAsync -- FileUploadJob类下的 ExecuteAsync 方法</p></blockquote><ul><li><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/3M0OzeZ86vmXAqze/img/640b0508-2ddd-4298-afd0-0d295170dac6.png" alt="image.png"></p></li><li><p>3.2.2  周期作业任务作业状态</p></li></ul><blockquote><p>可查看已经完成的任务</p></blockquote><ul><li><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/3M0OzeZ86vmXAqze/img/dfe2b965-3a8a-4a32-9e3a-c0aa72153485.png" alt="image.png"></li></ul><h4 id="_3-3其他可参考页面配置" tabindex="-1"><a class="header-anchor" href="#_3-3其他可参考页面配置"><span>3.3其他可参考页面配置</span></a></h4><h3 id="_4-配置说明" tabindex="-1"><a class="header-anchor" href="#_4-配置说明"><span>4. 配置说明</span></a></h3><blockquote><p><em>暂无</em></p></blockquote><h2 id="部署文档" tabindex="-1"><a class="header-anchor" href="#部署文档"><span>部署文档</span></a></h2><h3 id="环境要求" tabindex="-1"><a class="header-anchor" href="#环境要求"><span>环境要求</span></a></h3><ul><li>.NET 8 Runtime dotnet 8运行时</li></ul><blockquote><p><em>安装完成后,输入shell 命令 - whereis dotnet 查看路径</em></p></blockquote><ul><li>jenkins 配置部署命令<br> ``` shell<br> mkdir -p dotnet<br> rm -rf dotnet/<br><em>tar xf /root/filecloudsync.tgz -C dotnet</em><br><em>cd dotnet</em><br><em>dotnet publish —configuration Release</em><br><em>cp -rf /root/dotnet/DA.FileCloudSync.ApiServer/bin/Release/net8.0/publish/ /home/maoyf/hongbodev/dotnetFileServer/publish/</em><br><em>systemctl restart DA.ApiServer.service</em><br><em>systemctl status DA.ApiServer.service</em></li></ul><p><em>```</em></p><ul><li><em>DA.ApiServer.service 配置文件</em></li></ul><blockquote><p><em>无需更改, 在项目根目录下 Systemctl</em></p></blockquote><ul><li><em>Nginx 配置</em></li></ul><blockquote><p><em>需要开启 client_max_body_size 100m; 来传输fromdata表单文件</em></p></blockquote><blockquote><p><em>其他配置可按需添加</em></p></blockquote><h3 id="程序项目编译" tabindex="-1"><a class="header-anchor" href="#程序项目编译"><span>程序项目编译</span></a></h3><ul><li><p>Jenkins CICD 自动化部署</p></li><li><p>DA.FileCloudSync.ApiServer 推送到分支</p></li><li><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/3M0OzeZ86vmXAqze/img/14625f5c-2c48-4048-9c7e-31ea98bbfc61.png" alt="image.png"></p></li><li><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/3M0OzeZ86vmXAqze/img/ff6ddb0e-8fc0-4287-8b9c-90c3ce2cecfb.png" alt="image.png"></p></li><li><p>构建状态 绿色代表构建成功</p></li><li><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/3M0OzeZ86vmXAqze/img/0b5286f4-ed95-42b4-a8da-e7f89253359f.png" alt="image.png"></p></li></ul>',51)]))}]]),s=JSON.parse('{"path":"/work/2025/07/DA-File.html","title":"服务端部署说明","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"开发文档","slug":"开发文档","link":"#开发文档","children":[{"level":3,"title":"技术栈","slug":"技术栈","link":"#技术栈","children":[]},{"level":3,"title":"2. API接口设计","slug":"_2-api接口设计","link":"#_2-api接口设计","children":[]},{"level":3,"title":"3. 扩展功能","slug":"_3-扩展功能","link":"#_3-扩展功能","children":[]},{"level":3,"title":"4. 配置说明","slug":"_4-配置说明","link":"#_4-配置说明","children":[]}]},{"level":2,"title":"部署文档","slug":"部署文档","link":"#部署文档","children":[{"level":3,"title":"环境要求","slug":"环境要求","link":"#环境要求","children":[]},{"level":3,"title":"程序项目编译","slug":"程序项目编译","link":"#程序项目编译","children":[]}]}],"git":{"updatedTime":1751871781000,"contributors":[{"name":"Bo-Hong","username":"Bo-Hong","email":"2764136779@qq.com","commits":1,"url":"https://github.com/Bo-Hong"}],"changelog":[{"hash":"bd21f3a2b608ac684f4d6903317f30d9ae7d2cd2","time":1751871781000,"email":"2764136779@qq.com","author":"Bo-Hong","message":"文件上传工具文档"}]},"filePathRelative":"work/2025/07/DA-File.md"}')}}]);