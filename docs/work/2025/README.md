# 文件上传系统


## 服务端后端框架搭建集成
1. DI:AutoFac
2. ORM:SqlSugar
3. Cache:Redis
4. Log:Nlog
5. 程序中服务类重新封装，通用组件调整

## 账号管理
1. 机构管理
2. 部门管理
3. 平台管理
4. 账号管理 


## 权限管理
1. 登录端管理，区分客户端、服务端
2. 根据角色权限展示不同页面 (通过拦截器,AuthorizationHandler,ApiAuthorizeFilter 来判断角色权限)

## 基础数据同步
1. 机构同步
2. 科室信息同步
3. 账号同步

## 客户端相关接口
1. 登录接口
2. 文件上传信息接口
3. 客户端健康检查接口
4. 客户端异常信息接口

## AI中台对接
1. 上传信息同步，包含无关联关系 (根据条码号和样本号)
2. AI中台手动绑定关联关系信息反同

# 客户端
## 文件监控
1. 利用文件系统事件（如inotify/FileSystemWatcher）实现实时监控，同时配合定时扫描确保遗漏文件捕捉
2. 记录下事件详细信息，在配置的执行时间段异步处理 

## 流程逻辑
> 1.客户端使用Winform + AntdUI, 客户端登录
> ![1](https://github.com/user-attachments/assets/0a513214-1734-4736-9ab3-af1edb8a5773)
>
> 目的为了解决不同平台下,不同大小组,分别上次文件绑定到不同oss地址, (机构下有平台,平台绑定大小组和对应桶,)
> 客户端在上传配置的时候进行配置,例如(勾选大小组后配置大小组下对应的桶信息,)


> 2.服务端,

# 仪器接口

## 携光网口通讯
### 通过tcp网口通讯获取设备发过来的 条码号,或者 接收编号 ,通过http接口发送给iris系统,(通过base64 编码)

### 串口双向通讯, 优利特 US1680
1. 通过截取标识位
>解析出,当前仪器发送的 为请求检测信息标识则,根据仪器发送过来的信息,解析出条码号,

2. 解析仪器数据包,写入txt文件
> 获取对应的检测项目 可能存在多个检测项目,组装成仪器所需要的数据,发送给仪器,仪器会更具检测项目去执行对应检测项目逻辑,后 仪器发送数据包过来,通过标识位,解析出当前项目的结果值,生成报文写入到指定txt文件下

3. Http上传数据通过指定模板格式
> 通过定时任务发送http接口到iris接口,完成流程 (同时根据接收编号,来判断质控标识,如果真则调用接口使用质控模板发送http请求)


## 工作内容总结
1.负责后端服务的搭建
>封装数据访问层,帮助类,中间件(使用中间件,对返回的数据加密等,错误日志),角色等登录功能(使用Filter拦截方法),异常日志功能,AOP中间件(抽离重复字段查询)

2.基础数据接口实现和数据流程走通
> 预警管理通过,页面配置时间窗口,转成cron表达式 通过定时任务,来统计obs上传失败率和iris关联失败率

3.客户端,监控文件状态变化修改(FileSystemWatcher) 
> 根据用户配置,读取文件就到队列中,到华为obs中,发送请求给服务端, 服务端接收数据写入数据表,(数据表中有数据后,使用定时任务,轮询调用http请求接口,关联iris文件状态)

